<h1>{{groupbuy.title}}后台</h1>
<br>

<button class="btn btn-info" ng-click="refresh()">Refresh</button>
<button class="btn btn-danger" ng-click="addOrder()">Add Order</button>
<toggle-switch class="switch-success" ng-model="switchStatus" ng-click="toggle()"></toggle-switch>
<br>
<h1>Orders</h1>

<div class="col-sm-3 col-md-3 input-group">
    <input type="text" class="form-control" placeholder="Search phone..." ng-model="searchPhone">
    <div class="input-group-btn">
    	<button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button>
    </div>
</div>
<table class="table table-striped table-responsive" ng-init="tableInit()">
<thead>
    <tr>
    <th>订单时间</th>
    <th>微信名</th>
    <th>Email</th>
    <th>电话</th>
    <th ng-repeat-start="item in groupbuy.items" ng-repeat-end>{{item.item_name}}</th>
    <th>备注</th>
    <th>Action</th>
    </tr>
</thead>
<tbody>
    <tr ng-repeat="order in orders |orderBy:timestamp |filter:{phone_number:searchPhone}" ng-class="highlightRow(order)">
        <td>{{order.timestamp | date:'yyyy-MM-dd HH:mm'}}</td>
        <td>{{order.name}}</td>
        <td>{{order.email}}</td>
        <td>{{order.phone_number}}</td>
        <td ng-repeat-start="oi in order.items" ng-init="totalOrderItemCount[oi.item_name] = +totalOrderItemCount[oi.item_name] + +oi.item_count" ng-repeat-end>
            {{oi.item_count}}</td>
        <td>{{order.notes}}</td>
        <td>
            <button class="btn btn-info" ng-click="editOrder(order)">Edit</button>
            <button class="btn btn-info" ng-click="pickupOrder(order._id)" ng-disabled="order.pickedup">Pickup</button>
            <button class="btn btn-danger" ng-click="removeOrder(order._id)">Remove</button>
        </td>
    </tr>
    <tr class="warning totalRow">
        <td>Total</td>
        <td></td>
        <td></td>
        <td></td>
        <td ng-repeat-start="soi in totalOrderItemCount" ng-repeat-end>{{soi}}</td>
        <td></td>
        <td></td>
    </tr>
</tbody>
</table>


<!-- Modal -->
<div ng-controller="shopCtrl">
    <script type="text/ng-template" id="newOrder.html">
        <div class="modal-header">
            <div ng-if="editMode == true">
                <h3 class="modal-title">Edit Order</h3>
            </div>
            <div ng-if="editMode != true">
                <h3 class="modal-title">New Order</h3>
            </div>
        </div>
        <div class="modal-body">
            <h3>{{groupbuy.title}}</h3>

            微信名字
            <input class="form-control" ng-model="order.name"> 
            E-mail
            <input class="form-control" ng-model="order.email"> 
            电话(xxx-xxx-xxxx)
            <input class="form-control" ng-model="order.phone_number">
            
            <div data-ng-repeat="item in groupbuy.items">
                {{item.item_name}} price: {{item.item_price}}<br>
                <div ng-if="editMode == true">
                    订购数量: <input class="form-control" ng-model="orderItem[$index].item_count">
                </div>
                <div ng-if="editMode == false">
                    订购数量: <input class="form-control" ng-init="orderItem[$index].item_count=0" value=0 ng-model="orderItem[$index].item_count">
                </div>
            </div>
            备注
            <input class="form-control" ng-model="order.notes">
        <div class="modal-footer">
            <button class="btn btn-primary" type="button" ng-click="ok()">SAVE</button>
            <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>
        </div>
    </script>
</div>
